<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Tree Visualizer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/17.0.2/umd/react.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/17.0.2/umd/react-dom.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.16.0/d3.min.js"></script>
    <script src="https://unpkg.com/react-force-graph-2d"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }
        .button {
            margin: 5px;
            padding: 5px 10px;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
        }
        .button:hover {
            background-color: #e0e0e0;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const TreeVisualizer = () => {
            const [inputText, setInputText] = React.useState('g(a(b))');
            const [graphData, setGraphData] = React.useState({ nodes: [], links: [] });

            const examples = [
                { name: 'Simple', tree: 'a(b,c)' },
                { name: 'Nested', tree: 'x(y(z),w)' },
                { name: 'Complex', tree: 'a(b(d,e),c(f,g))' },
                { name: 'Deep', tree: 'm(n(o(p(q))))' }
            ];

            const parseTree = (input) => {
                const nodes = [];
                const links = [];
                let id = 0;

                const parse = (str) => {
                    const node = { id: id++, name: str[0] };
                    nodes.push(node);

                    let i = 2;
                    let childStart = i;
                    let depth = 0;

                    while (i < str.length && (depth > 0 || str[i] !== ')')) {
                        if (str[i] === '(') {
                            depth++;
                        } else if (str[i] === ')') {
                            depth--;
                        } else if (depth === 0 && str[i] === ',') {
                            const childNode = parse(str.slice(childStart, i));
                            links.push({ source: node.id, target: childNode.id });
                            childStart = i + 1;
                        }
                        i++;
                    }

                    if (childStart < i) {
                        const childNode = parse(str.slice(childStart, i));
                        links.push({ source: node.id, target: childNode.id });
                    }

                    return node;
                };

                try {
                    parse(input);
                    return { nodes, links };
                } catch (error) {
                    console.error('Invalid input:', error);
                    return null;
                }
            };

            React.useEffect(() => {
                const newGraphData = parseTree(inputText);
                if (newGraphData) {
                    setGraphData(newGraphData);
                }
            }, [inputText]);

            return (
                <div style={{ display: 'flex', height: '100vh' }}>
                    <div style={{ width: '33%', padding: '1rem', display: 'flex', flexDirection: 'column' }}>
                        <textarea
                            style={{ width: '100%', height: '70%', padding: '0.5rem', border: '1px solid #ccc', borderRadius: '4px', marginBottom: '1rem' }}
                            value={inputText}
                            onChange={(e) => setInputText(e.target.value)}
                            placeholder="Enter tree structure (e.g., g(a(b)))"
                        />
                        <div>
                            <h4>Examples:</h4>
                            <div style={{ display: 'flex', flexWrap: 'wrap' }}>
                                {examples.map((example, index) => (
                                    <button
                                        key={index}
                                        className="button"
                                        onClick={() => setInputText(example.tree)}
                                    >
                                        {example.name}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                    <div style={{ width: '67%' }}>
                        <ForceGraph2D
                            graphData={graphData}
                            nodeLabel="name"
                            nodeCanvasObject={(node, ctx, globalScale) => {
                                const label = node.name;
                                const fontSize = 12/globalScale;
                                ctx.font = `${fontSize}px Sans-Serif`;
                                ctx.textAlign = 'center';
                                ctx.textBaseline = 'middle';
                                ctx.fillStyle = 'black';
                                ctx.fillText(label, node.x, node.y);
                            }}
                            nodePointerAreaPaint={(node, color, ctx) => {
                                ctx.fillStyle = color;
                                const size = 5;
                                ctx.fillRect(node.x - size / 2, node.y - size / 2, size, size);
                            }}
                        />
                    </div>
                </div>
            );
        };

        ReactDOM.render(<TreeVisualizer />, document.getElementById('root'));
    </script>
</body>
</html>
